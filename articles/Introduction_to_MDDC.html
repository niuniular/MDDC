<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Usage Examples for MDDC in R • MDDC</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Usage Examples for MDDC in R">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MDDC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Introduction_to_MDDC.html">Usage Examples for MDDC in R</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/niuniular/MDDC/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Usage Examples for MDDC in R</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/niuniular/MDDC/blob/main/vignettes/Introduction_to_MDDC.Rmd" class="external-link"><code>vignettes/Introduction_to_MDDC.Rmd</code></a></small>
      <div class="d-none name"><code>Introduction_to_MDDC.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette contains various examples that illustrate usage of
<code>MDDC</code>.</p>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>The <code>MDDC</code> package is available on CRAN and can be
installed using the following code. Additionally, the development
version can be found on <a href="https://github.com/niuniular/MDDC" class="external-link">GitHub</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"MDDC"</span><span class="op">)</span></span></code></pre></div>
<p>We load the <code>MDDC</code> package using the following line:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/niuniular/MDDC" class="external-link">MDDC</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>We have included an adverse event dataset curated from FDA Adverse
Event Reporting System (FAERS) called <code>statin49</code> dataset
which we will be using for describing the functionalities of MDDC.
<code>statin49</code> was downloaded and processed from the FAERS
database, covering the period from the third quarter of 2014 (Q3 2014)
to the fourth quarter of 2020 (Q4 2020). This dataset is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>50</mn><mo>×</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">50\times 7</annotation></semantics></math>
contingency table. The first 49 rows represent 49 important adverse
events (AEs) associated with the statin class, while the final row
aggregates the remaining 5,990 AEs.</p>
<p>The dataset <code>AE_idx</code> lists the cluster index of each AE in
the <code>statin49</code> dataset. The 49 AEs are classified into three
clusters: 1) AEs associated with signs and symptoms of muscle injury, 2)
AEs associated with laboratory tests for muscle injury, and 3) AEs
associated with kidney injury and its laboratory diagnosis and
treatment.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"statin49"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">statin49</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    Atorvastatin Fluvastatin Lovastatin Pravastatin Rosuvastatin</span></span>
<span><span class="co">#&gt; Rhabdomyolysis             2041          52         44         163          936</span></span>
<span><span class="co">#&gt; Muscle Disorder             291           2          7          21          191</span></span>
<span><span class="co">#&gt; Muscle Fatigue               85           0          2          16           30</span></span>
<span><span class="co">#&gt; Muscle Haemorrhage           24           0          0           5           13</span></span>
<span><span class="co">#&gt; Muscle Necrosis              68           2          0           1           10</span></span>
<span><span class="co">#&gt; Muscle Rupture              181          25          0          61           36</span></span>
<span><span class="co">#&gt;                    Simvastatin Other</span></span>
<span><span class="co">#&gt; Rhabdomyolysis            1376 31707</span></span>
<span><span class="co">#&gt; Muscle Disorder             87  7329</span></span>
<span><span class="co">#&gt; Muscle Fatigue              39  4257</span></span>
<span><span class="co">#&gt; Muscle Haemorrhage           4  3806</span></span>
<span><span class="co">#&gt; Muscle Necrosis             20   662</span></span>
<span><span class="co">#&gt; Muscle Rupture             120  3219</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"statin49_AE_idx"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">statin49_AE_idx</span><span class="op">)</span></span>
<span><span class="co">#&gt;   idx                 AE</span></span>
<span><span class="co">#&gt; 1   1     Rhabdomyolysis</span></span>
<span><span class="co">#&gt; 2   1    Muscle Disorder</span></span>
<span><span class="co">#&gt; 3   1     Muscle Fatigue</span></span>
<span><span class="co">#&gt; 4   1 Muscle Haemorrhage</span></span>
<span><span class="co">#&gt; 5   1    Muscle Necrosis</span></span>
<span><span class="co">#&gt; 6   1     Muscle Rupture</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adverse-event-ae-identification-with-mddc">Adverse Event (AE) Identification with MDDC<a class="anchor" aria-label="anchor" href="#adverse-event-ae-identification-with-mddc"></a>
</h2>
<div class="section level3">
<h3 id="using-boxplot-method">Using Boxplot Method<a class="anchor" aria-label="anchor" href="#using-boxplot-method"></a>
</h3>
<p>Our goal is to identify (AE, drug) pairs with abnormally high report
counts, specifically those cells with counts significantly exceeding
their expected values.</p>
<p>First we perform the analysis using <code><a href="../reference/mddc_boxplot.html">mddc_boxplot()</a></code>. This
function has five argument:</p>
<ul>
<li><p><code>contin_table</code>: A data matrix of an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>×</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">I \times J</annotation></semantics></math>
contingency table with rows representing adverse events and columns
representing drugs. We recommend users first check the input contingency
table using the function
<code><a href="../reference/check_and_fix_contin_table.html">check_and_fix_contin_table()</a></code>.</p></li>
<li><p><code>col_specific_cutoff</code>: Logical. In the step 2 of the
algorithm, whether to apply the boxplot method to the standardized
Pearson residuals within each drug column (default is <code>TRUE</code>)
or to the entire table (<code>FALSE</code>).</p></li>
<li><p><code>separate</code>: Logical. In the step 2 of the algorithm,
whether to separate the standardized Pearson residuals for the zero
cells and non zero cells and apply boxplot method separately or
together. Default is <code>TRUE</code>.</p></li>
<li><p><code>if_col_cor</code>: Logical. In the step 3 of the algorithm,
whether to use column (drug) correlation or row (adverse event)
correlation. Default is <code>FALSE</code>, indicating the use of
adverse event correlation. <code>TRUE</code> indicates the use of drug
correlation.</p></li>
<li><p><code>cor_lim</code>: A numeric value between 0 and 1. Specifies
the correlation threshold to select “connected” adverse events in step
3. Default is 0.8.</p></li>
<li><p><code>num_cores</code>: Number of cores used to parallelize the
MDDC Boxplot algorithm. Default is 2.</p></li>
</ul>
<p>We now perform the MDDC (boxplot) analysis with the
<code>statin49</code> dataset:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mddc_boxplot.html">mddc_boxplot</a></span><span class="op">(</span></span>
<span>  contin_table <span class="op">=</span> <span class="va">statin49</span>,</span>
<span>  col_specific_cutoff <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  separate <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  if_col_cor <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  cor_lim <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span>  </span></code></pre></div>
<p>The above function outputs a list with three components:</p>
<ul>
<li><p><code>boxplot_signal</code>: An
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>×</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">I\times J</annotation></semantics></math>
data matrix with entries 1 or 0, indicating the signals identified in
the step 2. A value of 1 indicates signals, 0 indicates no
signal.</p></li>
<li><p><code>corr_signal_pval</code>: An
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>×</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">I\times J</annotation></semantics></math>
data matrix of p-values for each cell in the contingency table from step
5, when the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">r_{ij}</annotation></semantics></math>
values are mapped back to the standard normal distribution.</p></li>
<li><p><code>corr_signal_adj_pval</code>: An
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>×</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">I\times J</annotation></semantics></math>
data matrix of the Benjamini-Hochberg adjusted p-values for each cell in
step 5. Users can choose whether to use <code>corr_signal_pval</code> or
<code>corr_signal_adj_pval</code>, and can set their own p-value
threshold (for example, 0.05).</p></li>
</ul>
<p>Below, we display the first few rows and columns for each component
of <code>test1</code>. We first check the component
<code>boxplot_signal</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test1</span><span class="op">$</span><span class="va">boxplot_signal</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;                    Atorvastatin Fluvastatin Lovastatin Pravastatin Rosuvastatin</span></span>
<span><span class="co">#&gt; Rhabdomyolysis                1           0          0           1            1</span></span>
<span><span class="co">#&gt; Muscle Disorder               0           0          0           0            1</span></span>
<span><span class="co">#&gt; Muscle Fatigue                0           0          0           0            0</span></span>
<span><span class="co">#&gt; Muscle Haemorrhage            0           0          0           0            0</span></span>
<span><span class="co">#&gt; Muscle Necrosis               0           0          0           0            0</span></span>
<span><span class="co">#&gt; Muscle Rupture                0           0          0           1            0</span></span></code></pre></div>
<p>This indicates the pairs (Rhabdomyolysis, Atorvastatin),
(Rhabdomyolysis, Pravastatin), (Muscle Rupture, Pravastatin),
(Rhabdomyolysis, Rosuvastatin), and (Muscle Disorder, Rosuvastatin) are
identified as signals in step 2 of MDDC (boxplot). Now we look at the
second component <code>corr_signal_pval</code> which shows the p-values
of all the cells from step 5:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test1</span><span class="op">$</span><span class="va">corr_signal_pval</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    Atorvastatin Fluvastatin Lovastatin Pravastatin Rosuvastatin</span></span>
<span><span class="co">#&gt; Rhabdomyolysis               NA          NA         NA          NA           NA</span></span>
<span><span class="co">#&gt; Muscle Disorder           0.527       0.974      0.178       0.545        0.000</span></span>
<span><span class="co">#&gt; Muscle Fatigue            0.556       0.834      0.252       0.061        0.656</span></span>
<span><span class="co">#&gt; Muscle Haemorrhage        0.561       0.635      0.521       0.307        0.570</span></span>
<span><span class="co">#&gt; Muscle Necrosis           0.534       0.186      0.869       0.835        0.677</span></span>
<span><span class="co">#&gt; Muscle Rupture            0.569       0.019      0.999       0.000        0.678</span></span></code></pre></div>
<p>In this output, we observe that the first row, corresponding to the
adverse event “Rhabdomyolysis”, does not have associated p-values. This
is because, in step 2 of the algorithm, “Rhabdomyolysis” was already
identified as an AE signal for Atorvastatin, Pravastatin, Rosuvastatin,
and Simvastatin. Consequently, the standardized Pearson residual values
for these four drugs were replaced with NA. With only two residual
values remaining in the first row, it was not possible to find connected
AEs for “Rhabdomyolysis”. Therefore, this adverse event was excluded
from the subsequent steps of the analysis. Note that for computing
Pearson correlation in step 3, at least three values are required in the
matching positions. Applying a p-value threshold of 0.05, we identify
the following pairs as signals by considering AE correlations: (Muscle
Rupture, Fluvastatin), (Muscle Rupture, Pravastatin), and (Muscle
Disorder, Rosuvastatin).</p>
<p>The third component, <code>corr_signal_adj_pval</code>, provides the
Benjamini-Hochberg adjusted p-values. Users can choose whether to use
<code>corr_signal_pval</code> or <code>corr_signal_adj_pval</code> and
can set their own p-value threshold (for example, 0.05).</p>
</div>
<div class="section level3">
<h3 id="using-monte-carlo-method">Using Monte Carlo Method<a class="anchor" aria-label="anchor" href="#using-monte-carlo-method"></a>
</h3>
<p>Next, we introduce another primary function of this package,
<code><a href="../reference/mddc_mc.html">mddc_mc()</a></code>, which implements the MDDC (MC) algorithm. This
function has the following arguments:</p>
<ul>
<li><p><code>contin_table</code>: A data matrix of an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>×</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">I\times J</annotation></semantics></math>
contingency table with rows representing adverse events and columns
representing drugs. We recommend users first check the input contingency
table using the function
<code><a href="../reference/check_and_fix_contin_table.html">check_and_fix_contin_table()</a></code>.</p></li>
<li><p><code>quantile_mc</code>: In step 2 of the algorithm, this
specifies the quantile of the null distribution obtained via the Monte
Carlo (MC) method to use as a threshold for identifying cells with high
values of standardized Pearson residuals. The default is 0.95.</p></li>
<li><p><code>mc_num</code>: The number of Monte Carlo replications to
perform in step 2. The default is 10,000.</p></li>
<li><p><code>exclude_same_drug_class</code>: In step 2, when applying
Fisher’s exact test to cells with a count less than six, a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2\times2</annotation></semantics></math>
contingency table is constructed. This argument specifies whether to
exclude other drugs in the same class as the drug of interest. The
default is <code>TRUE</code>.</p></li>
<li><p><code>col_specific_cutoff</code>: Logical. Specifies whether to
apply the MC method to the standardized Pearson residuals of the entire
table or within each drug column in step 2. The default is
<code>TRUE</code>, indicating column-specific cutoff. <code>FALSE</code>
applies the MC method to the residuals of the entire table.</p></li>
<li><p><code>separate</code>: Logical. In step 2 of the algorithm,
indicates whether to separate the standardized Pearson residuals for
zero cells and non-zero cells, applying the MC method separately. The
default is <code>TRUE</code>.</p></li>
<li><p><code>if_col_cor</code>: Logical. In step 3 of the algorithm,
specifies whether to use column (drug) correlation or row (adverse
event) correlation. The default is <code>FALSE</code>, indicating the
use of adverse event correlation. <code>TRUE</code> indicates the use of
drug correlation.</p></li>
<li><p><code>cor_lim</code>: A numeric value between 0 and 1. Specifies
the correlation threshold to use in step 3 for selecting “connected”
adverse events. The default is 0.8.</p></li>
<li><p><code>num_cores</code>: Number of cores used to parallelize the
MDDC Boxplot algorithm. Default is 2.</p></li>
<li><p><code>seed</code>: An optional integer to set the seed for
reproducibility. If NULL, no seed is set.</p></li>
</ul>
<p>We now apply MDDC (MC) algorithm to <code>statin49</code> using the
following code:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mddc_mc.html">mddc_mc</a></span><span class="op">(</span></span>
<span>  contin_table <span class="op">=</span> <span class="va">statin49</span>,</span>
<span>  quantile <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  rep <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  exclude_same_drug_class <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  col_specific_cutoff <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  separate <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  if_col_cor <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  cor_lim <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span>    </span></code></pre></div>
<p>This function outputs a list with five components:</p>
<ul>
<li><p><code>mc_pval</code>: Returns the p-values for each cell in step
2. For cells with counts greater than five, the p-values are obtained
via the Monte Carlo (MC) method. For cells with counts less than or
equal to five, the p-values are obtained via Fisher’s exact
tests.</p></li>
<li><p><code>mc_signal</code>: Indicates signals for cells with counts
greater than five, identified in step 2 by the MC method. A value of 1
indicates a signal, while 0 indicates no signal.</p></li>
<li><p><code>fisher_signal</code>: Indicates signals for cells with
counts less than or equal to five, identified in step 2 by Fisher’s
exact tests. A value of 1 indicates a signal, while 0 indicates no
signal.</p></li>
<li><p><code>corr_signal_pval</code>: Returns the p-values for each cell
in the contingency table in step 5, where the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">r_{ij}</annotation></semantics></math>
values are mapped back to the standard normal distribution.</p></li>
<li><p><code>corr_signal_adj_pval</code>: Returns the Benjamini-Hochberg
adjusted p-values for each cell in step 5. Users can choose whether to
use <code>corr_signal_pval</code> or <code>corr_signal_adj_pval</code>,
and select an appropriate p-value threshold (for example,
0.05).</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="function-for-reporting">Function for Reporting<a class="anchor" aria-label="anchor" href="#function-for-reporting"></a>
</h2>
<p>This package includes a postprocessing function
<code><a href="../reference/report_drug_AE_pairs.html">report_drug_AE_pairs()</a></code> for display the identified (AE,
drug) pairs as well as the observed count, expected count and the
standardized Pearson residuals for the pairs. This function takes two
arguments:</p>
<ul>
<li><p><code>contin_table</code>: A data matrix representing an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>×</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">I \times J</annotation></semantics></math>
contingency table, with rows corresponding to adverse events and columns
corresponding to drugs.</p></li>
<li><p><code>contin_table_signal</code>: A data matrix with the same
dimensions and row and column names as <code>contin_table</code>.
Entries should be either 1 (indicating a signal) or 0 (indicating no
signal). This matrix can be obtained by applying the
<code><a href="../reference/mddc_boxplot.html">mddc_boxplot()</a></code> or <code><a href="../reference/mddc_mc.html">mddc_mc()</a></code> functions to
<code>contin_table</code>.</p></li>
</ul>
<p>Now we apply this function to the second component
<code>mc_signal</code> we obtained above and display the first few
rows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/report_drug_AE_pairs.html">report_drug_AE_pairs</a></span><span class="op">(</span></span>
<span>  contin_table <span class="op">=</span> <span class="va">statin49</span>,</span>
<span>  contin_table_signal <span class="op">=</span> <span class="va">test2</span><span class="op">$</span><span class="va">mc_signal</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test3</span><span class="op">)</span></span>
<span><span class="co">#&gt;           drug                 AE observed_num expected_num std_pearson_res</span></span>
<span><span class="co">#&gt; 1 Atorvastatin     Rhabdomyolysis         2041     112.0567        182.5555</span></span>
<span><span class="co">#&gt; 2 Atorvastatin    Muscle Disorder          291      24.4606         53.9791</span></span>
<span><span class="co">#&gt; 3 Atorvastatin     Muscle Fatigue           85       13.665         19.3279</span></span>
<span><span class="co">#&gt; 4 Atorvastatin Muscle Haemorrhage           24      11.8848          3.5198</span></span>
<span><span class="co">#&gt; 5 Atorvastatin    Muscle Necrosis           68       2.3541         42.8516</span></span>
<span><span class="co">#&gt; 6 Atorvastatin     Muscle Rupture          181      11.2368          50.723</span></span></code></pre></div>
<p>These (AE, drug) pairs are part of the signals identified by the MDDC
(MC) method in the step 2 for pairs with counts greater than five.
Similarly, we can apply this function to the signals obtained from the
correlation steps using the following code. Here we use a threshold of
0.05 for selecting the signals from step 5. We omit the output for
brevity.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/report_drug_AE_pairs.html">report_drug_AE_pairs</a></span><span class="op">(</span></span>
<span>  contin_table <span class="op">=</span> <span class="va">statin49</span>,</span>
<span>  contin_table_signal <span class="op">=</span> <span class="va">test2</span><span class="op">$</span><span class="va">corr_signal_pval</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt;            drug                                        AE observed_num</span></span>
<span><span class="co">#&gt; 1  Atorvastatin                 Diaphragm Muscle Weakness           14</span></span>
<span><span class="co">#&gt; 2  Atorvastatin     Blood Creatine Phosphokinase Abnormal           34</span></span>
<span><span class="co">#&gt; 3  Atorvastatin                            Myoglobinaemia           15</span></span>
<span><span class="co">#&gt; 4   Fluvastatin                             Myoglobinuria            4</span></span>
<span><span class="co">#&gt; 5   Fluvastatin                          Renal Impairment           52</span></span>
<span><span class="co">#&gt; 6    Lovastatin                       Myasthenic Syndrome            9</span></span>
<span><span class="co">#&gt; 7  Rosuvastatin Blood Creatine Phosphokinase Mm Increased            9</span></span>
<span><span class="co">#&gt; 8  Rosuvastatin                   Blood Calcium Decreased          110</span></span>
<span><span class="co">#&gt; 9  Rosuvastatin      Creatinine Renal Clearance Decreased          124</span></span>
<span><span class="co">#&gt; 10  Simvastatin                            Myopathy Toxic           21</span></span>
<span><span class="co">#&gt; 11  Simvastatin     Blood Creatine Phosphokinase Abnormal           11</span></span>
<span><span class="co">#&gt; 12        Other                             Renal Failure       250710</span></span>
<span><span class="co">#&gt;    expected_num std_pearson_res</span></span>
<span><span class="co">#&gt; 1         0.361         22.7358</span></span>
<span><span class="co">#&gt; 2        0.9688         33.6109</span></span>
<span><span class="co">#&gt; 3        0.2376         30.3341</span></span>
<span><span class="co">#&gt; 4        0.0302          22.827</span></span>
<span><span class="co">#&gt; 5        9.3488         13.9613</span></span>
<span><span class="co">#&gt; 6        0.0334         49.0479</span></span>
<span><span class="co">#&gt; 7        0.0478         40.9642</span></span>
<span><span class="co">#&gt; 8       30.7404         14.3109</span></span>
<span><span class="co">#&gt; 9       15.1319         28.0154</span></span>
<span><span class="co">#&gt; 10       0.6838         24.5848</span></span>
<span><span class="co">#&gt; 11       0.4194         16.3495</span></span>
<span><span class="co">#&gt; 12  250051.2658         15.9753</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulating-datasets-with-grouped-aes">Simulating datasets with grouped AEs<a class="anchor" aria-label="anchor" href="#simulating-datasets-with-grouped-aes"></a>
</h2>
<p>This package offers a data generation function for simulating
pharmacovigilance datasets, with the option to incorporate grouped AEs.
This function can embed correlations between the standardized Pearson
residuals for AEs and takes five arguments:</p>
<ul>
<li><p><code>contin_table</code>: A data matrix representing an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>×</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">I \times J</annotation></semantics></math>
contingency table with rows corresponding to adverse events and columns
corresponding to drugs. The row and column marginals are used to
generate the simulated data.</p></li>
<li><p><code>n_rep</code>: The number of simulated contingency tables to
be generated.</p></li>
<li><p><code>AE_idx</code>: A data frame with two variables,
<code>idx</code> and <code>AE</code>, where <code>idx</code> indicates
the cluster index (either a name or a number), and <code>AE</code> lists
the adverse event names. An example named <code>AE_idx</code>, which
provides the AE group index for the <code>statin49</code> dataset, is
included in the package.</p></li>
<li><p><code>rho</code>: A numeric value representing the correlation of
the AEs within each cluster. The default is 0.5.</p></li>
<li><p><code>signal_mat</code>: A data matrix of the same dimensions as
the contingency table with entries indicating the signal strength.
Values must be greater than or equal to 1, where 1 indicates no signal,
and values greater than 1 indicate a signal.</p></li>
</ul>
<p>Now we demonstrate the usage of this function by generating three
simulated datasets based on the marginals of <code>statin49</code>.
First, we need to create a data matrix with the same dimensions as
<code>statin49</code> that indicates the signal strength for each (AE,
drug) pair. In this example, we assign a signal (Rhabdomyolysis,
Atorvastatin) with a strength of 4 to the simulated dataset:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a matrix indicating signal strength</span></span>
<span><span class="va">sig_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>                  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">statin49</span><span class="op">)</span>,</span>
<span>                  ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">statin49</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># assign (Rhabdomyolysis, Atorvastain) as a signal</span></span>
<span><span class="co"># with a signal strength 4</span></span>
<span><span class="va">sig_mat</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4</span>  </span></code></pre></div>
<p>The 49 AEs in <code>statin49</code> can be grouped into three
clusters, as listed in the <code>statin49_AE_idx</code>: 1) AEs
associated with signs and symptoms of muscle injury, 2) AEs associated
with laboratory tests for muscle injury, 3) AEs associated with kidney
injury and its laboratory diagnosis and treatment. Next we take a look
at the first few rows of <code>sttain49_AE_idx</code>, which indicate
the group index of each AE in <code>statin49</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">statin49_AE_idx</span><span class="op">)</span></span>
<span><span class="co">#&gt;   idx                 AE</span></span>
<span><span class="co">#&gt; 1   1     Rhabdomyolysis</span></span>
<span><span class="co">#&gt; 2   1    Muscle Disorder</span></span>
<span><span class="co">#&gt; 3   1     Muscle Fatigue</span></span>
<span><span class="co">#&gt; 4   1 Muscle Haemorrhage</span></span>
<span><span class="co">#&gt; 5   1    Muscle Necrosis</span></span>
<span><span class="co">#&gt; 6   1     Muscle Rupture</span></span></code></pre></div>
<p>Now we generate 3 simulated contingency tables based on the marginals
of <code>statin49</code>, the pre-specified matrix of signal strength,
and the AE group index, with a within group correlation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\rho=0.5</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_contin_table_with_clustered_AE.html">generate_contin_table_with_clustered_AE</a></span><span class="op">(</span></span>
<span>  contin_table <span class="op">=</span> <span class="va">statin49</span>,</span>
<span>  n_rep <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  AE_idx <span class="op">=</span> <span class="va">statin49_AE_idx</span>,</span>
<span>  rho <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  signal_mat <span class="op">=</span> <span class="va">sig_mat</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This function returns a list of simulated contingency tables, with
the length of the list equal to the number of replications specified in
the argument <code>n_rep</code>. In this example, we have
<code>n_rep = 3</code>. Now we perform the MDDC (MC) analysis on the
first simulated contingency table and extract the identified pairs from
step 2:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mddc_mc.html">mddc_mc</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/report_drug_AE_pairs.html">report_drug_AE_pairs</a></span><span class="op">(</span>contin_table <span class="op">=</span> <span class="va">sim_dat</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                     contin_table_signal <span class="op">=</span> <span class="va">test5</span><span class="op">$</span><span class="va">mc_signal</span><span class="op">)</span></span>
<span><span class="co">#&gt;           drug             AE observed_num expected_num std_pearson_res</span></span>
<span><span class="co">#&gt; 1 Atorvastatin Rhabdomyolysis          457     113.3853         32.3288</span></span>
<span><span class="co">#&gt; 2        Other       Other AE     61678634 61678273.228           3.247</span></span></code></pre></div>
<p>In the output, there is one pair (Rhabdomyolysis, Atorvastatin)
identified, which matches what we embedded.</p>
</div>
<div class="section level2">
<h2 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h2>
<p>We have also included heatmap visulizations as a part of our package
to help visualize the identified signals or p-values.</p>
<p>This function takes the following arguments:</p>
<ul>
<li><p><code>data</code>: A matrix or data frame to be visualized as a
heatmap. The row names and column names of the data will be used for
labeling the heatmap axes.</p></li>
<li><p><code>cell_width</code>: Numeric value indicating the width of
each cell in the heatmap. Default is 1.</p></li>
<li><p><code>cell_height</code>: Numeric value indicating the height of
each cell in the heatmap. Default is 1.</p></li>
</ul>
<p>The following heatmap shows the visualization of the associated
p-values of Monte Carlo method in step 2:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_heatmap.html">plot_heatmap</a></span><span class="op">(</span><span class="va">test2</span><span class="op">$</span><span class="va">mc_pval</span><span class="op">[</span>,<span class="op">-</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_to_MDDC_files/figure-html/unnamed-chunk-15-1.png" width="576"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anran Liu, Raktim Mukhopadhyay, Marianthi Markatou.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
